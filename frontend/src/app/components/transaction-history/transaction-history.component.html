<div class="transaction-history">
  <div class="history-header">
    <h3>Transaction History</h3>
    <div class="export-buttons">
      <button class="export-icon-btn csv" (click)="exportToCSV()" title="Export CSV">
        <svg viewBox="0 0 100 100" class="file-icon">
          <rect x="15" y="10" width="70" height="80" rx="5" fill="#ffffff" stroke="#4a5568" stroke-width="2"/>
          <rect x="25" y="20" width="50" height="15" rx="2" fill="#38a169"/>
          <text x="50" y="32" text-anchor="middle" fill="white" font-size="10" font-weight="bold">CSV</text>
          <line x1="25" y1="45" x2="65" y2="45" stroke="#a0aec0" stroke-width="2"/>
          <line x1="25" y1="55" x2="55" y2="55" stroke="#a0aec0" stroke-width="2"/>
          <line x1="25" y1="65" x2="70" y2="65" stroke="#a0aec0" stroke-width="2"/>
          <line x1="25" y1="75" x2="60" y2="75" stroke="#a0aec0" stroke-width="2"/>
        </svg>
      </button>
      <button class="export-icon-btn pdf" (click)="exportToPDF()" title="Export PDF">
        <svg viewBox="0 0 100 100" class="file-icon">
          <rect x="15" y="10" width="70" height="80" rx="5" fill="#ffffff" stroke="#4a5568" stroke-width="2"/>
          <rect x="25" y="20" width="50" height="15" rx="2" fill="#e53e3e"/>
          <text x="50" y="32" text-anchor="middle" fill="white" font-size="10" font-weight="bold">PDF</text>
          <line x1="25" y1="45" x2="70" y2="45" stroke="#a0aec0" stroke-width="2"/>
          <line x1="25" y1="55" x2="65" y2="55" stroke="#a0aec0" stroke-width="2"/>
          <line x1="25" y1="65" x2="60" y2="65" stroke="#a0aec0" stroke-width="2"/>
          <line x1="25" y1="75" x2="70" y2="75" stroke="#a0aec0" stroke-width="2"/>
        </svg>
      </button>
      <span class="flagged-count">Flagged: {{ flaggedCount }}</span>
    </div>
  </div>
  
  <!-- Search and Filters -->
  <div class="filters-section" *ngIf="transactions.length > 0">
    <div class="search-bar">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        placeholder="Search by merchant, ID, or currency..."
        class="search-input"
      >
    </div>
    <div class="filter-controls">
      <select [(ngModel)]="filterStatus" class="filter-select">
        <option value="all">All Status</option>
        <option value="approved">Approved</option>
        <option value="flagged">Flagged</option>
      </select>
      <select [(ngModel)]="filterRisk" class="filter-select">
        <option value="all">All Risk Levels</option>
        <option value="low">Low Risk (≤30)</option>
        <option value="medium">Medium Risk (31-70)</option>
        <option value="high">High Risk (>70)</option>
      </select>
      <select [(ngModel)]="sortBy" class="filter-select">
        <option value="timestamp">Sort by Date</option>
        <option value="amount">Sort by Amount</option>
        <option value="risk_score">Sort by Risk</option>
        <option value="merchant">Sort by Merchant</option>
      </select>
      <select [(ngModel)]="sortOrder" class="filter-select">
        <option value="desc">Descending</option>
        <option value="asc">Ascending</option>
      </select>
    </div>
  </div>
  
  <div class="empty-state" *ngIf="transactions.length === 0">
    <p>No transactions yet. Submit your first transaction to see it here.</p>
  </div>
  
  <div class="empty-state" *ngIf="transactions.length > 0 && filteredTransactions.length === 0">
    <p>No transactions match your filters. Try adjusting your search criteria.</p>
  </div>
  
  <div class="transaction-list" *ngIf="filteredTransactions.length > 0">
    <div *ngFor="let transaction of filteredTransactions" class="transaction-item">
      <div class="transaction-header">
        <span class="transaction-id">ID: {{ transaction.transaction_id }}</span>
        <span class="transaction-date">
          {{ transaction.timestamp ? (transaction.timestamp | date:'medium') : 'N/A' }}
        </span>
        <div class="transaction-actions">
          <button 
            class="clone-btn" 
            (click)="onClone(transaction)"
            title="Clone transaction"
          >
            Clone
          </button>
          <button 
            class="delete-btn" 
            (click)="onDelete(transaction.transaction_id)"
            title="Delete transaction"
          >
            ×
          </button>
        </div>
      </div>
      <div class="transaction-details">
        <div class="detail-item">
          <span class="detail-label">Amount:</span>
          <span class="detail-value">{{ getCurrencySymbol(transaction.currency) }}{{ (transaction.amount || 0).toFixed(2) }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Merchant:</span>
          <span class="detail-value">{{ transaction.merchant }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Risk Score:</span>
          <span class="detail-value" [ngClass]="getRiskClass(transaction.risk_score || 0)">
            {{ transaction.risk_score || 0 }}
          </span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Status:</span>
          <span class="detail-value status">{{ transaction.status }}</span>
        </div>
      </div>
    </div>
  </div>
</div>